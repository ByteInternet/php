From 12fe4e90be7bfa2a763197079f68f5568a14e071 Mon Sep 17 00:00:00 2001
From: Remi Collet <remi@php.net>
Date: Wed, 27 Nov 2013 11:13:16 +0100
Subject: [PATCH] Fixed bug #66060 (Heap buffer over-read in DateInterval)

---
 NEWS                                | 3 +++
 ext/date/lib/parse_iso_intervals.c  | 4 ++--
 ext/date/lib/parse_iso_intervals.re | 2 +-
 3 files changed, 6 insertions(+), 3 deletions(-)

--- php5.orig/ext/date/lib/parse_iso_intervals.c
+++ php5/ext/date/lib/parse_iso_intervals.c
@@ -415,7 +415,7 @@ yy6:
 					break;
 			}
 			ptr++;
-		} while (*ptr);
+		} while (!s->errors->error_count && *ptr);
 		s->have_period = 1;
 		TIMELIB_DEINIT;
 		return TIMELIB_PERIOD;
--- php5.orig/ext/date/lib/parse_iso_intervals.re
+++ php5/ext/date/lib/parse_iso_intervals.re
@@ -383,7 +383,7 @@ isoweek          = year4 "-"? "W" weekof
 					break;
 			}
 			ptr++;
-		} while (*ptr);
+		} while (!s->errors->error_count && *ptr);
 		s->have_period = 1;
 		TIMELIB_DEINIT;
 		return TIMELIB_PERIOD;
